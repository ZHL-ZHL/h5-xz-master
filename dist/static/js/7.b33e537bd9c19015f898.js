webpackJsonp([7],{aCFZ:function(e,t){},emDE:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("Xxa5"),i=a.n(n),s=a("exGp"),r=a.n(s),c={props:{id:0},data:function(){return{vipList:[],form:"",price:0,VIP_price:99,res:{},index:1,show:!1,current_index:0,packet_key:""}},computed:{level:function(){return 1*localStorage.getItem("level")},platform_id:function(){return this.getUrlParam("platform_id")},isweixin:function(){return"micromessenger"==navigator.userAgent.toLowerCase().match(/MicroMessenger/i)}},created:function(){var e=this;return r()(i.a.mark(function t(){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.$route.query.payback&&(e.uuid=e.$route.query.uuid,e.id=e.$route.query.id,e.$router.push({name:"my"}));case 2:case"end":return t.stop()}},t,e)}))()},methods:{getUrlParam:function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),a=window.location.search.substr(1).match(t);return null!=a?unescape(a[2]):null},getVip:function(){var e=this;this.$http.get("package/vip").then(function(t){e.vipList=t.data,e.packet_key=t.data[0].key,e.price=t.data[0].price/100})},pay_success:function(){var e=this;this.$http.get("auth/info").then(function(t){200==t.code&&(localStorage.setItem("nickname",t.data.nickname),localStorage.setItem("gender",t.data.gender),localStorage.setItem("vip_end_time",t.data.vip_end_time),localStorage.setItem("avatar",t.data.avatar),localStorage.setItem("level",t.data.level)),e.$router.push({name:"my"})})},is_weixn:function(){return"micromessenger"==navigator.userAgent.toLowerCase().match(/MicroMessenger/i)},back:function(){window.history.length<=1?this.$router.push({name:"main"}):this.$router.go(-1)},buyItem:function(){this.price=this.res.present_price},check_pay:function(){var e=this;return r()(i.a.mark(function t(){var a;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$http.get("order/status/"+e.uuid);case 2:if(200!=(a=t.sent).code){t.next=12;break}if(1!=a.data.status){t.next=11;break}return t.next=7,e.$http.get("order/test_question/question",{params:{uuid:e.uuid}});case 7:200==t.sent.code&&e.pay_success(),t.next=12;break;case 11:setTimeout(function(){e.check_pay()},2e3);case 12:case"end":return t.stop()}},t,e)}))()},ali_pay:function(){var e=this;return r()(i.a.mark(function t(){var a;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.pop_show=!0,e.show=!1,t.next=4,e.$http.post("pay/alipay/wappay",{number:1,package_key:e.packet_key,package_type:0,platform_id:0,total_fee:1});case 4:200==(a=t.sent).code&&(e.form=a.data.form,e.uuid=a.data.uuid,e.$nextTick(function(e){document.querySelector("input[type=submit]").click()})),e.check_pay();case 7:case"end":return t.stop()}},t,e)}))()},weixin_pay:function(){var e=this;return r()(i.a.mark(function t(){var a,n;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.is_weixn()){t.next=10;break}return t.next=3,e.$http.post("pay/wxpay/jsapi_prepay",{number:1,package_key:e.packet_key,package_type:0,platform_id:0,total_fee:1});case 3:a=t.sent,n=a.data,e.uuid=a.data.uuid,WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:n.app_id,timeStamp:n.time_stamp,nonceStr:n.nonce_str,package:n.packages,signType:n.sign_type,paySign:n.pay_sign},function(e){e.err_msg}),e.check_pay(),t.next=11;break;case 10:e.h5_pay();case 11:case"end":return t.stop()}},t,e)}))()},h5_pay:function(){var e=this;return r()(i.a.mark(function t(){var a,n,s;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$http.post("pay/wxpay/h5_url",{number:1,package_key:e.packet_key,package_type:0,platform_id:e.platform_id,total_fee:1});case 2:200==(a=t.sent).code&&(a.data,e.uuid=a.data.uuid,n=location.href+"?uuid="+e.uuid+"&id="+e.id+"&payback=1",s=a.data.url+"&redirect_url="+encodeURIComponent(n),window.location.replace(s));case 4:case"end":return t.stop()}},t,e)}))()}},mounted:function(){this.getVip()}},o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page-tips"},[a("div",{staticClass:"back",on:{click:e.back}}),e._v(" "),a("div",{staticClass:"title"},[e._v("VIP会员套餐")]),e._v(" "),a("div",{staticClass:"vip"},[a("div",{staticClass:"vip-list"},e._l(e.vipList,function(t,n){return a("div",{key:n},[a("div",{staticClass:"vip-item",class:{on:e.current_index==n},on:{click:function(a){e.current_index=n,e.packet_key=t.key,e.price=t.price/100}}},[e._v("\n          ¥"+e._s(t.price/100)+"/\n          "),"vip_month"==t.key?a("span",[e._v("月")]):e._e(),e._v(" "),"vip_year"==t.key?a("span",[e._v("年")]):e._e(),e._v(" "),"vip_life"==t.key?a("span",[e._v("永久")]):e._e()])])}),0),e._v(" "),a("div",{staticClass:"buy-button",on:{click:function(t){e.show=!0}}},[e._v("立即开通")])]),e._v(" "),e._m(0),e._v(" "),a("div",{staticClass:"hidden",domProps:{innerHTML:e._s(this.form)}}),e._v(" "),a("van-popup",{attrs:{position:"bottom"},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[a("div",{staticClass:"popup"},[a("span",{staticClass:"cha iconfont icon-cha",on:{click:function(t){e.show=!1}}}),e._v(" "),a("div",{staticClass:"pop-price"},[e._v(e._s(e._f("cy")(e.price)))]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!e.isweixin,expression:"!isweixin"}],staticClass:"item",on:{click:e.ali_pay}},[a("span",{staticClass:"left"},[a("span",{staticClass:"zhifubao"}),e._v(" "),a("span",{staticClass:"name"},[e._v("支付宝")])]),e._v(" "),a("span",{staticClass:"arrow iconfont icon-arrowR"})]),e._v(" "),a("div",{staticClass:"item",on:{click:e.weixin_pay}},[a("span",{staticClass:"left"},[a("span",{staticClass:"weixin"}),e._v(" "),a("span",{staticClass:"name"},[e._v("微信")])]),e._v(" "),a("span",{staticClass:"arrow iconfont icon-arrowR"})])])])],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"des"},[t("div",{staticClass:"des-title"},[this._v("会员说明:")])])}]};var p=a("VU/8")(c,o,!1,function(e){a("aCFZ")},"data-v-d7ba7232",null);t.default=p.exports}});
//# sourceMappingURL=7.b33e537bd9c19015f898.js.map