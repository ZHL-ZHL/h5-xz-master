webpackJsonp([9],{ds1e:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("Xxa5"),r=a.n(i),s=a("exGp"),n=a.n(s),o=a("teIl"),c=a("TVmP"),d={data:function(){return{form:"",finished:!1,show:!1,rowDetail:{},pageIndex:1,pageSize:100,cards:[],activeIndex:null,isFinished:!1,pageLoaded:!1}},created:function(){var e=this;return n()(r.a.mark(function t(){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.$route.query.payback&&(e.uuid=e.$route.query.uuid,e.id=e.$route.query.id,e.$router.push({name:"CardRecordsItem",params:{type:"random",id:e.id}}));case 2:case"end":return t.stop()}},t,e)}))()},computed:{level:function(){return 1*localStorage.getItem("level")},platform_id:function(){return this.getUrlParam("platform_id")},isweixin:function(){return"micromessenger"==navigator.userAgent.toLowerCase().match(/MicroMessenger/i)}},methods:{vip_pay_free:function(){var e=this;return n()(r.a.mark(function t(){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$http.post("order/card_category/paid_user/save",{platform_id:e.platform_id,ref_ids:[e.rowDetail.id]});case 2:200==t.sent.code&&e.$router.push({name:"CardRecordsItem",params:{type:"random",id:e.rowDetail.id,isdailyfortune:e.rowDetail.is_daily_fortune}});case 4:case"end":return t.stop()}},t,e)}))()},pay_free:function(){var e=this;return n()(r.a.mark(function t(){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$http.post("order/card_category/free/save",{platform_id:e.platform_id,ref_ids:[e.rowDetail.id]});case 2:200==t.sent.code&&e.$router.push({name:"CardRecordsItem",params:{type:"random",id:e.rowDetail.id,isdailyfortune:e.rowDetail.is_daily_fortune}});case 4:case"end":return t.stop()}},t,e)}))()},back:function(){window.history.length<=1?this.$router.push({name:"main"}):this.$router.go(-1)},getUrlParam:function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),a=window.location.search.substr(1).match(t);return null!=a?unescape(a[2]):null},fetch:function(){var e=this;return n()(r.a.mark(function t(){var a;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$http.get("card/category/page",{params:{page_index:e.pageIndex,page_size:e.pageSize,parent_id:e.$route.params.id,type:2}});case 2:a=t.sent,e.pageLoaded=!0,200==a.code&&(e.cards=a.data.result);case 5:case"end":return t.stop()}},t,e)}))()},toDetail:function(){this.$router.push({name:"CardRecordsItem",params:{type:"random",id:this.rowDetail.id,isdailyfortune:this.rowDetail.is_daily_fortune}})},pay_success:function(e){this.$router.push({name:"CardRecordsItem",params:{type:"random",id:this.rowDetail.id,isdailyfortune:this.rowDetail.is_daily_fortune}})},ali_pay:function(){var e=this;return n()(r.a.mark(function t(){var a;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.pop_show=!0,e.show=!1,t.next=4,e.$http.post("pay/alipay/wappay",{number:1,package_key:"num_1",package_type:2,platform_id:e.platform_id,ref_ids:[e.rowDetail.id],total_fee:1});case 4:200==(a=t.sent).code&&(e.uuid=a.data.uuid,e.form=a.data.form,e.$nextTick(function(e){document.querySelector("input[type=submit]").click()})),e.check_pay();case 7:case"end":return t.stop()}},t,e)}))()},h5_pay:function(){var e=this;return n()(r.a.mark(function t(){var a,i,s;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$http.post("pay/wxpay/h5_url",{number:1,package_key:"num_1",package_type:2,platform_id:e.platform_id,ref_ids:[e.rowDetail.id],total_fee:1});case 2:200==(a=t.sent).code&&(a.data,e.uuid=a.data.uuid,i=location.href+"?uuid="+e.uuid+"&id="+e.rowDetail.id+"&payback=1&isdailyfortune="+e.rowDetail.is_daily_fortune,s=a.data.url+"&redirect_url="+encodeURIComponent(i),window.location.replace(s));case 4:case"end":return t.stop()}},t,e)}))()},weixin_pay:function(){var e=this;return n()(r.a.mark(function t(){var a,i;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.is_weixn()){t.next=10;break}return t.next=3,e.$http.post("pay/wxpay/jsapi_prepay",{number:1,package_key:"num_1",package_type:2,platform_id:e.platform_id,ref_ids:[e.rowDetail.id],total_fee:1});case 3:a=t.sent,i=a.data,e.uuid=a.data.uuid,WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:i.app_id,timeStamp:i.time_stamp,nonceStr:i.nonce_str,package:i.packages,signType:i.sign_type,paySign:i.pay_sign},function(e){"get_brand_wcpay_request:ok"==e.err_msg&&this.$router.push({name:"CardRecordsItem",params:{type:"random",id:this.rowDetail.id,isdailyfortune:this.rowDetail.is_daily_fortune}})}),e.check_pay(),t.next=11;break;case 10:e.h5_pay();case 11:console.log(res);case 12:case"end":return t.stop()}},t,e)}))()},check_pay:function(){var e=this;return n()(r.a.mark(function t(){var a;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$http.get("order/status/"+e.uuid);case 2:if(200!=(a=t.sent).code){t.next=12;break}if(1!=a.data.status){t.next=11;break}return t.next=7,e.$http.get("order/test_question/question",{params:{uuid:e.uuid}});case 7:200==t.sent.code&&e.$router.push({name:"CardRecordsItem",params:{type:"random",id:e.rowDetail.id,isdailyfortune:e.rowDetail.is_daily_fortune}}),t.next=12;break;case 11:setTimeout(function(){e.check_pay()},2e3);case 12:case"end":return t.stop()}},t,e)}))()},is_weixn:function(){return"micromessenger"==navigator.userAgent.toLowerCase().match(/MicroMessenger/i)}},mounted:function(){this.fetch()},components:{Header:o.a,Footer:c.a}},u={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"hello"},[a("Header"),e._v(" "),a("div",{staticClass:"main"},[a("div",{staticClass:"star-cards"},e._l(e.cards,function(t,i){return a("div",{key:i,staticClass:"card-item",class:{on:e.activeIndex==i},on:{click:function(a){e.activeIndex=i,e.rowDetail=t,e.finished=!0}}},[a("div",{staticClass:"card-des"},[a("div",{staticClass:"star-name"},[e._v(e._s(t.name))])])])}),0),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.finished,expression:"finished"}]},[1==e.rowDetail.is_paid?a("div",[a("div",{staticClass:"btn-test",on:{click:e.toDetail}})]):e._e(),e._v(" "),0==e.rowDetail.is_paid?a("div",[a("div",{directives:[{name:"show",rawName:"v-show",value:1==e.rowDetail.is_vip_free||!(e.level>0),expression:"rowDetail.is_vip_free == 1 || !(level>0)"}]},[e.rowDetail.present_price>0?a("div",{staticClass:"pay"},[a("div",{staticClass:"btn-test",on:{click:function(t){e.show=!0}}})]):e._e(),e._v(" "),0==e.rowDetail.present_price?a("div",{staticClass:"pay-free"},[a("div",{staticClass:"btn-test",on:{click:e.pay_free}})]):e._e()]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:0==e.rowDetail.is_vip_free&&e.level>0,expression:"rowDetail.is_vip_free == 0 && level>0"}],staticClass:"pay-free"},[a("div",{staticClass:"btn-test",on:{click:e.vip_pay_free}})])]):e._e()])]),e._v(" "),a("Footer",{attrs:{on:!0}}),e._v(" "),a("div",{staticClass:"hidden",domProps:{innerHTML:e._s(this.form)}}),e._v(" "),a("van-popup",{attrs:{position:"bottom"},model:{value:e.show,callback:function(t){e.show=t},expression:"show"}},[a("div",{staticClass:"popup"},[a("span",{staticClass:"cha iconfont icon-cha",on:{click:function(t){e.show=!1}}}),e._v(" "),a("div",{staticClass:"pop-price",on:{click:e.pay_success}},[e._v("¥ "+e._s(e._f("cy")(e.rowDetail.present_price)))]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!e.isweixin,expression:"!isweixin"}],staticClass:"item",on:{click:e.ali_pay}},[a("span",{staticClass:"left"},[a("span",{staticClass:"zhifubao"}),e._v(" "),a("span",{staticClass:"name"},[e._v("支付宝")])]),e._v(" "),a("span",{staticClass:"arrow iconfont icon-arrowR"})]),e._v(" "),a("div",{staticClass:"item",on:{click:e.weixin_pay}},[a("span",{staticClass:"left"},[a("span",{staticClass:"weixin"}),e._v(" "),a("span",{staticClass:"name"},[e._v("微信")])]),e._v(" "),a("span",{staticClass:"arrow iconfont icon-arrowR"})])])])],1)},staticRenderFns:[]};var p=a("VU/8")(d,u,!1,function(e){a("oDQi")},"data-v-795627bf",null);t.default=p.exports},oDQi:function(e,t){}});
//# sourceMappingURL=9.e8584dfbde839b3f9e15.js.map